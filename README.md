# Эчпочмак Бот

Это Telegram-бот на Python, который отслеживает упоминания слов **"эчпочмак"** и **"учпочмак"** в групповых чатах и ведёт их подсчёт. Бот может сообщить количество упоминаний по команде.

## Функциональность

- Отслеживает упоминания слов **"эчпочмак"** и **"учпочмак"** во всех их формах склонения.
- Ведёт подсчёт упоминаний отдельно для каждого чата.
- По команде `/echpochmak` сообщает количество упоминаний в текущем чате.

## Технологии

- **Язык программирования:** Python 3.9
- **Библиотеки:**
  - `python-telegram-bot==13.14`
- **База данных:** SQLite (используется для хранения счётчика упоминаний)
- **Контейнеризация:** Docker и Docker Compose

## Установка и запуск

### Предварительные требования

- **Docker** версии 19.03 и выше
- **Docker Compose** версии 1.27 и выше
- **Telegram Bot Token** (полученный от [@BotFather](https://t.me/BotFather))

### Шаги по установке

1. **Клонируйте репозиторий или скопируйте файлы проекта в директорию на вашем компьютере.**

2. **Перейдите в директорию проекта:**

   ```bash
   cd path_to_your_project
   ```

3. **Создайте файл `.env` в корневой директории проекта и добавьте в него ваш токен бота:**

   ```
   TELEGRAM_BOT_TOKEN=ВАШ_ТОКЕН_БОТА
   ```

   > **Важно:** Убедитесь, что файл `.env` добавлен в `.gitignore`, чтобы не публиковать ваш токен в системах контроля версий.

4. **Создайте директорию `data` для хранения базы данных:**

   ```bash
   mkdir data
   ```

5. **Соберите Docker-образ бота:**

   ```bash
   docker-compose build
   ```

6. **Запустите бота в контейнере:**

   ```bash
   docker-compose up -d
   ```

   Флаг `-d` запускает контейнер в фоновом режиме.

7. **Проверьте логи бота, чтобы убедиться, что он запущен без ошибок:**

   ```bash
   docker-compose logs -f
   ```

### Настройка бота в Telegram

1. **Отключите режим приватности бота через [@BotFather](https://t.me/BotFather):**

   - Отправьте команду `/setprivacy`.
   - Выберите вашего бота.
   - Выберите опцию `Disable` для отключения режима приватности.

2. **Добавьте бота в ваш групповой чат:**

   - Откройте ваш групповой чат в Telegram.
   - Добавьте бота в группу через меню добавления участников.

3. **Используйте бота в чате:**

   - Отправьте сообщение с упоминанием слова **"эчпочмак"** или **"учпочмак"** в любой форме.
   - Используйте команду `/echpochmak`, чтобы узнать количество упоминаний.

## Структура проекта

```
project/
├── echpochmak_bot.py        # Код бота
├── Dockerfile               # Dockerfile для сборки образа
├── docker-compose.yml       # Конфигурация Docker Compose
├── requirements.txt         # Зависимости проекта
├── .env                     # Файл с переменными окружения (НЕ публикуется)
├── data/                    # Директория для хранения базы данных
└── .gitignore               # Файл для исключения файлов из контроля версий
```

## Файлы проекта

### 1. `echpochmak_bot.py`

Это основной файл с кодом бота. Он содержит:

- Обработчики команд `/start`, `/echpochmak`.
- Логику подсчёта упоминаний и работу с базой данных.
- Функции для проверки прав администратора.

### 2. `Dockerfile`

Определяет, как собирать Docker-образ для бота.

```dockerfile
FROM python:3.9-slim

RUN useradd -ms /bin/bash botuser

WORKDIR /app

COPY requirements.txt .

RUN pip install --no-cache-dir -r requirements.txt

COPY echpochmak_bot.py .

RUN mkdir /app/data && chown -R botuser:botuser /app/data

USER botuser

CMD ["python", "echpochmak_bot.py"]
```

### 3. `docker-compose.yml`

Конфигурация для Docker Compose, которая определяет сервис бота и его настройки.

```yaml
version: '3.8'

services:
  echpochmak_bot:
    build: .
    container_name: echpochmak_bot
    restart: unless-stopped
    env_file:
      - .env
    volumes:
      - ./data:/app/data
```

### 4. `requirements.txt`

Содержит список зависимостей проекта.

```
python-telegram-bot==13.14
```

### 5. `.env`

Файл с переменными окружения. Содержит ваш токен бота.

```
TELEGRAM_BOT_TOKEN=ВАШ_ТОКЕН_БОТА
```

### 6. `.gitignore`

Файл для исключения файлов из системы контроля версий.

```
.env
data/
__pycache__/
*.pyc
```

## Управление ботом

### Просмотр логов

Чтобы посмотреть логи работы бота, выполните команду:

```bash
docker-compose logs -f
```

### Остановка бота

Для остановки бота и удаления контейнера выполните:

```bash
docker-compose down
```

### Обновление бота

Если вы внесли изменения в код бота, пересоберите образ и перезапустите контейнер:

```bash
docker-compose down
docker-compose build
docker-compose up -d
```

## Безопасность

- **Хранение токена:** Убедитесь, что ваш токен бота хранится безопасно и не публикуется в открытых источниках. Добавьте файл `.env` в `.gitignore`.
- **Права доступа:** Бот запускается от имени не-привилегированного пользователя внутри контейнера для повышения безопасности.

## Дополнительные настройки

### Добавление новых слов для отслеживания

Вы можете добавить новые слова и их формы в списки `ECHPOCHMAK_FORMS` и `UCHPOCHMAK_FORMS` в файле `echpochmak_bot.py`.

```python
ECHPOCHMAK_FORMS = [
    'эчпочмак', 'эчпочмака', 'эчпочмаку', 'эчпочмаком', 'эчпочмаке',
    'эчпочмаки', 'эчпочмаков', 'эчпочмакам', 'эчпочмаками', 'эчпочмаках'
    # Добавьте дополнительные формы при необходимости
]

UCHPOCHMAK_FORMS = [
    'учпочмак', 'учпочмака', 'учпочмаку', 'учпочмаком', 'учпочмаке',
    'учпочмаки', 'учпочмаков', 'учпочмакам', 'учпочмаками', 'учпочмаках'
    # Добавьте дополнительные формы при необходимости
]
```

После внесения изменений пересоберите образ и перезапустите контейнер.

### Изменение версии Python или зависимостей

- Для изменения версии Python отредактируйте строку в `Dockerfile`:

  ```dockerfile
  FROM python:3.9-slim
  ```

- Обновите зависимости в `requirements.txt` и пересоберите образ.

## Возможные проблемы

### Проблемы с подключением к базе данных

Если бот не может подключиться к базе данных, убедитесь, что:

- Директория `data/` существует и имеет правильные права доступа.
- В `docker-compose.yml` правильно настроено монтирование тома.
- Бот запускается от имени пользователя с достаточными правами.

### Бот не отвечает на сообщения в группе

- Убедитесь, что режим приватности бота отключен через [@BotFather](https://t.me/BotFather).
- Проверьте, что бот добавлен в группу и имеет права на чтение сообщений.
- Проверьте логи бота на наличие ошибок.

## Обратная связь

Если у вас есть вопросы или предложения по улучшению бота, вы можете связаться с разработчиком или создать issue в репозитории проекта.

## Лицензия

Этот проект распространяется под лицензией MIT. Подробности смотрите в файле `LICENSE`.

---

**Примечание:** Этот README предназначен для помощи в настройке и использовании бота. Пожалуйста, замените `path_to_your_project` на фактический путь к вашему проекту при выполнении команд.